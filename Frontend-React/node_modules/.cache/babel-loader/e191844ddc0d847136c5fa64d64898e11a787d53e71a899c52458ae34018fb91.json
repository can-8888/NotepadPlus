{"ast":null,"code":"var _jsxFileName = \"D:\\\\_master\\\\v5\\\\notepad-plus\\\\src\\\\components\\\\NoteEditor.tsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from 'react';\nimport './NoteEditor.css'; // Make sure this is the exact path\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst NoteEditor = ({\n  note,\n  onSave,\n  onCancel\n}) => {\n  _s();\n  console.log('NoteEditor rendered with note:', note);\n  const [title, setTitle] = useState((note === null || note === void 0 ? void 0 : note.title) || '');\n  const [content, setContent] = useState((note === null || note === void 0 ? void 0 : note.content) || '');\n  const [category, setCategory] = useState((note === null || note === void 0 ? void 0 : note.category) || '');\n  const [isSaving, setIsSaving] = React.useState(false);\n  const [collaborators, setCollaborators] = React.useState([]);\n  const contentRef = useRef(null);\n  const lastUpdateRef = useRef(0);\n  const updateTimeoutRef = useRef();\n  const typingTimeoutRef = useRef();\n  const [undoStack, setUndoStack] = useState([]);\n  const [redoStack, setRedoStack] = useState([]);\n  const lastSavedRef = useRef('');\n  const autoSaveTimeoutRef = useRef();\n  const [versions, setVersions] = useState([]);\n  const [showVersions, setShowVersions] = useState(false);\n  const [versionName, setVersionName] = useState('');\n  useEffect(() => {\n    if (note) {\n      // Editing existing note\n      setTitle(note.title);\n      setContent(note.content);\n      setCategory(note.category);\n\n      // Enhanced collaborator tracking\n      signalRService.onCollaboratorJoined(username => {\n        const color = getColorForUsername(username);\n        setCollaborators(prev => [...prev, {\n          username,\n          isTyping: false,\n          color,\n          cursorPosition: undefined,\n          selection: undefined\n        }]);\n      });\n      signalRService.onCollaboratorLeft(username => {\n        setCollaborators(prev => prev.filter(c => c.username !== username));\n      });\n\n      // Typing indicators\n      signalRService.onUserStartedTyping(username => {\n        setCollaborators(prev => prev.map(c => c.username === username ? {\n          ...c,\n          isTyping: true\n        } : c));\n      });\n      signalRService.onUserStoppedTyping(username => {\n        setCollaborators(prev => prev.map(c => c.username === username ? {\n          ...c,\n          isTyping: false\n        } : c));\n      });\n\n      // Cursor tracking\n      signalRService.onCursorMoved((username, position) => {\n        setCollaborators(prev => prev.map(c => c.username === username ? {\n          ...c,\n          cursorPosition: position\n        } : c));\n        showCollaboratorCursor(username, position);\n      });\n    } else {\n      // Creating new note\n      setTitle('');\n      setContent('');\n      setCategory('');\n    }\n    return () => {\n      if (note) {\n        console.log('NoteEditor unmounting');\n      }\n      if (typingTimeoutRef.current) {\n        clearTimeout(typingTimeoutRef.current);\n      }\n    };\n  }, [note === null || note === void 0 ? void 0 : note.id]);\n  const showCollaboratorCursor = (username, position) => {\n    var _contentRef$current$p;\n    if (!contentRef.current) return;\n    const existingCursor = document.querySelector(`.collaborator-cursor-${username}`);\n    existingCursor === null || existingCursor === void 0 ? void 0 : existingCursor.remove();\n    const cursor = document.createElement('div');\n    cursor.className = `collaborator-cursor collaborator-cursor-${username}`;\n    cursor.setAttribute('data-username', username);\n    cursor.style.color = getColorForUsername(username);\n    const {\n      top,\n      left\n    } = calculateCursorPosition(position);\n    cursor.style.top = `${top}px`;\n    cursor.style.left = `${left}px`;\n    (_contentRef$current$p = contentRef.current.parentElement) === null || _contentRef$current$p === void 0 ? void 0 : _contentRef$current$p.appendChild(cursor);\n    setTimeout(() => cursor.remove(), 2000);\n  };\n  const calculateCursorPosition = position => {\n    if (!contentRef.current) return {\n      top: 0,\n      left: 0\n    };\n    const textArea = contentRef.current;\n    const textBeforeCursor = content.substring(0, position);\n    const lines = textBeforeCursor.split('\\n');\n    const lineHeight = 20; // Approximate line height\n    const charWidth = 8; // Approximate character width\n\n    return {\n      top: (lines.length - 1) * lineHeight,\n      left: lines[lines.length - 1].length * charWidth\n    };\n  };\n  const getColorForUsername = username => {\n    const colors = ['#2196f3', '#4caf50', '#f44336', '#ff9800', '#9c27b0'];\n    let hash = 0;\n    for (let i = 0; i < username.length; i++) {\n      hash = username.charCodeAt(i) + ((hash << 5) - hash);\n    }\n    return colors[Math.abs(hash) % colors.length];\n  };\n  const handleContentChange = e => {\n    const newContent = e.target.value;\n    setContent(newContent);\n\n    // Notify typing started\n    if (note) {\n      signalRService.notifyTypingStarted(note.id);\n\n      // Clear existing timeout\n      if (typingTimeoutRef.current) {\n        clearTimeout(typingTimeoutRef.current);\n      }\n\n      // Set new timeout to notify typing stopped\n      typingTimeoutRef.current = setTimeout(() => {\n        if (note) {\n          signalRService.notifyTypingStopped(note.id);\n        }\n      }, 1000);\n\n      // Throttle content updates\n      const now = Date.now();\n      if (now - lastUpdateRef.current > 500) {\n        signalRService.updateNote(note.id, newContent);\n        lastUpdateRef.current = now;\n      } else {\n        if (updateTimeoutRef.current) {\n          clearTimeout(updateTimeoutRef.current);\n        }\n        updateTimeoutRef.current = setTimeout(() => {\n          signalRService.updateNote(note.id, newContent);\n          lastUpdateRef.current = Date.now();\n        }, 500);\n      }\n    }\n  };\n  const updateCursorPosition = () => {\n    if (!note || !contentRef.current) return;\n    const textarea = contentRef.current;\n    const cursorPosition = textarea.selectionStart;\n    signalRService.updateCursorPosition(note.id, cursorPosition);\n  };\n  const handleMouseMove = e => {\n    updateCursorPosition();\n  };\n  const handleKeyUp = e => {\n    updateCursorPosition();\n  };\n  const handleSave = async () => {\n    try {\n      setIsSaving(true);\n      await onSave({\n        ...(note || {}),\n        title,\n        content,\n        category\n      });\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  // Add selection tracking\n  const handleSelectionChange = () => {\n    if (!note || !contentRef.current) return;\n    const textarea = contentRef.current;\n    const selection = {\n      start: textarea.selectionStart,\n      end: textarea.selectionEnd\n    };\n    if (selection.start !== selection.end) {\n      signalRService.updateSelection(note.id, selection);\n    }\n  };\n\n  // Add undo/redo handling\n  const addToHistory = content => {\n    if (!contentRef.current) return;\n    setUndoStack(prev => {\n      var _contentRef$current$s, _contentRef$current;\n      return [...prev, {\n        content,\n        cursorPosition: (_contentRef$current$s = (_contentRef$current = contentRef.current) === null || _contentRef$current === void 0 ? void 0 : _contentRef$current.selectionStart) !== null && _contentRef$current$s !== void 0 ? _contentRef$current$s : 0\n      }];\n    });\n    setRedoStack([]);\n  };\n  const undo = () => {\n    var _contentRef$current$s2, _contentRef$current2;\n    if (undoStack.length === 0) return;\n    const current = {\n      content,\n      cursorPosition: (_contentRef$current$s2 = (_contentRef$current2 = contentRef.current) === null || _contentRef$current2 === void 0 ? void 0 : _contentRef$current2.selectionStart) !== null && _contentRef$current$s2 !== void 0 ? _contentRef$current$s2 : 0\n    };\n    const previous = undoStack[undoStack.length - 1];\n    setRedoStack(prev => [...prev, current]);\n    setUndoStack(prev => prev.slice(0, -1));\n    setContent(previous.content);\n    if (contentRef.current) {\n      contentRef.current.selectionStart = previous.cursorPosition;\n      contentRef.current.selectionEnd = previous.cursorPosition;\n    }\n    if (note) {\n      signalRService.updateNote(note.id, previous.content);\n    }\n  };\n  const redo = () => {\n    var _contentRef$current$s3, _contentRef$current3;\n    if (redoStack.length === 0) return;\n    const current = {\n      content,\n      cursorPosition: (_contentRef$current$s3 = (_contentRef$current3 = contentRef.current) === null || _contentRef$current3 === void 0 ? void 0 : _contentRef$current3.selectionStart) !== null && _contentRef$current$s3 !== void 0 ? _contentRef$current$s3 : 0\n    };\n    const next = redoStack[redoStack.length - 1];\n    setUndoStack(prev => [...prev, current]);\n    setRedoStack(prev => prev.slice(0, -1));\n    setContent(next.content);\n    if (contentRef.current) {\n      contentRef.current.selectionStart = next.cursorPosition;\n      contentRef.current.selectionEnd = next.cursorPosition;\n    }\n    if (note) {\n      signalRService.updateNote(note.id, next.content);\n    }\n  };\n\n  // Add auto-save functionality\n  useEffect(() => {\n    if (note && content !== lastSavedRef.current) {\n      if (autoSaveTimeoutRef.current) {\n        clearTimeout(autoSaveTimeoutRef.current);\n      }\n\n      // Instead of auto-saving, just update via SignalR for collaboration\n      if (note.id) {\n        autoSaveTimeoutRef.current = setTimeout(() => {\n          signalRService.updateNote(note.id, content);\n          lastSavedRef.current = content;\n        }, 3000);\n      }\n    }\n    return () => {\n      if (autoSaveTimeoutRef.current) {\n        clearTimeout(autoSaveTimeoutRef.current);\n      }\n    };\n  }, [content, note]);\n\n  // Add keyboard shortcuts\n  useEffect(() => {\n    const handleKeyDown = e => {\n      if ((e.ctrlKey || e.metaKey) && e.key === 'z') {\n        e.preventDefault();\n        if (e.shiftKey) {\n          redo();\n        } else {\n          undo();\n        }\n      }\n    };\n    document.addEventListener('keydown', handleKeyDown);\n    return () => document.removeEventListener('keydown', handleKeyDown);\n  }, [undo, redo]);\n\n  // Add version saving functionality\n  const handleSaveVersion = async () => {\n    if (!note || !versionName.trim()) return;\n    try {\n      await signalRService.saveVersion(note.id, content, versionName);\n      setVersionName('');\n      // Version list will be updated via SignalR\n    } catch (err) {\n      console.error('Failed to save version:', err);\n    }\n  };\n\n  // Add version loading functionality\n  const loadVersion = version => {\n    setContent(version.content);\n    if (note) {\n      signalRService.updateNote(note.id, version.content);\n    }\n  };\n\n  // Add logging to form submission\n  const handleSubmit = async e => {\n    e.preventDefault();\n    console.log('Form submitted');\n    await onSave({\n      id: note === null || note === void 0 ? void 0 : note.id,\n      title,\n      content,\n      category,\n      userId: note === null || note === void 0 ? void 0 : note.userId\n    });\n  };\n  return /*#__PURE__*/_jsxDEV(\"form\", {\n    onSubmit: handleSubmit,\n    className: \"note-editor\",\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: note ? 'Edit Note' : 'Create Note'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 373,\n      columnNumber: 13\n    }, this), collaborators.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"collaborators\",\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        children: \"Currently editing: \"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 376,\n        columnNumber: 21\n      }, this), collaborators.map(collaborator => /*#__PURE__*/_jsxDEV(\"span\", {\n        className: `collaborator-badge ${collaborator.isTyping ? 'typing' : ''}`,\n        style: {\n          backgroundColor: getColorForUsername(collaborator.username)\n        },\n        children: [collaborator.username, collaborator.isTyping && /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"typing-indicator\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 384,\n          columnNumber: 55\n        }, this)]\n      }, collaborator.username, true, {\n        fileName: _jsxFileName,\n        lineNumber: 378,\n        columnNumber: 25\n      }, this))]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 375,\n      columnNumber: 17\n    }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n      type: \"text\",\n      placeholder: \"Title\",\n      value: title,\n      onChange: e => setTitle(e.target.value)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 389,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n      type: \"text\",\n      placeholder: \"Category\",\n      value: category,\n      onChange: e => setCategory(e.target.value)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 395,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"editor-toolbar\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: undo,\n        disabled: undoStack.length === 0,\n        children: \"Undo\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 402,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: redo,\n        disabled: redoStack.length === 0,\n        children: \"Redo\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 405,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => setShowVersions(!showVersions),\n        children: showVersions ? 'Hide Versions' : 'Show Versions'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 408,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 401,\n      columnNumber: 13\n    }, this), showVersions && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"version-panel\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"version-header\",\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          placeholder: \"Version name\",\n          value: versionName,\n          onChange: e => setVersionName(e.target.value)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 416,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleSaveVersion,\n          disabled: !versionName.trim(),\n          children: \"Save Version\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 422,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 415,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"version-list\",\n        children: versions.map(version => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"version-item\",\n          onClick: () => loadVersion(version),\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"version-name\",\n            children: version.name\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 436,\n            columnNumber: 33\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"version-date\",\n            children: new Date(version.createdAt).toLocaleString()\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 437,\n            columnNumber: 33\n          }, this)]\n        }, version.id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 431,\n          columnNumber: 29\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 429,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 414,\n      columnNumber: 17\n    }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n      ref: contentRef,\n      placeholder: \"Note content...\",\n      value: content,\n      onChange: handleContentChange,\n      onClick: handleMouseMove,\n      onKeyUp: handleKeyUp,\n      onSelect: handleSelectionChange\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 445,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"button-group\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleSave,\n        disabled: isSaving,\n        children: isSaving ? 'Saving...' : note ? 'Save' : 'Create'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 455,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: onCancel,\n        children: \"Cancel\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 461,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 454,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 372,\n    columnNumber: 9\n  }, this);\n};\n_s(NoteEditor, \"ixW2omToCFLTGVr61PH3v7i/eKk=\");\n_c = NoteEditor;\nexport default NoteEditor;\nvar _c;\n$RefreshReg$(_c, \"NoteEditor\");","map":{"version":3,"names":["React","useEffect","useRef","useState","jsxDEV","_jsxDEV","NoteEditor","note","onSave","onCancel","_s","console","log","title","setTitle","content","setContent","category","setCategory","isSaving","setIsSaving","collaborators","setCollaborators","contentRef","lastUpdateRef","updateTimeoutRef","typingTimeoutRef","undoStack","setUndoStack","redoStack","setRedoStack","lastSavedRef","autoSaveTimeoutRef","versions","setVersions","showVersions","setShowVersions","versionName","setVersionName","signalRService","onCollaboratorJoined","username","color","getColorForUsername","prev","isTyping","cursorPosition","undefined","selection","onCollaboratorLeft","filter","c","onUserStartedTyping","map","onUserStoppedTyping","onCursorMoved","position","showCollaboratorCursor","current","clearTimeout","id","_contentRef$current$p","existingCursor","document","querySelector","remove","cursor","createElement","className","setAttribute","style","top","left","calculateCursorPosition","parentElement","appendChild","setTimeout","textArea","textBeforeCursor","substring","lines","split","lineHeight","charWidth","length","colors","hash","i","charCodeAt","Math","abs","handleContentChange","e","newContent","target","value","notifyTypingStarted","notifyTypingStopped","now","Date","updateNote","updateCursorPosition","textarea","selectionStart","handleMouseMove","handleKeyUp","handleSave","handleSelectionChange","start","end","selectionEnd","updateSelection","addToHistory","_contentRef$current$s","_contentRef$current","undo","_contentRef$current$s2","_contentRef$current2","previous","slice","redo","_contentRef$current$s3","_contentRef$current3","next","handleKeyDown","ctrlKey","metaKey","key","preventDefault","shiftKey","addEventListener","removeEventListener","handleSaveVersion","trim","saveVersion","err","error","loadVersion","version","handleSubmit","userId","onSubmit","children","fileName","_jsxFileName","lineNumber","columnNumber","collaborator","backgroundColor","type","placeholder","onChange","onClick","disabled","name","createdAt","toLocaleString","ref","onKeyUp","onSelect","_c","$RefreshReg$"],"sources":["D:/_master/v5/notepad-plus/src/components/NoteEditor.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport { Note } from '../types/Note';\nimport './NoteEditor.css';  // Make sure this is the exact path\n\ninterface NoteEditorProps {\n    note?: Note;\n    onSave: (note: Partial<Note>) => Promise<void>;\n    onCancel: () => void;\n}\n\ninterface Selection {\n    start: number;\n    end: number;\n}\n\ninterface CollaboratorState {\n    username: string;\n    isTyping: boolean;\n    cursorPosition?: number;\n    selection?: Selection;\n    color: string;\n}\n\ninterface HistoryEntry {\n    content: string;\n    cursorPosition: number;\n}\n\ninterface Version {\n    id: string;\n    content: string;\n    createdAt: Date;\n    name: string;\n}\n\nconst NoteEditor: React.FC<NoteEditorProps> = ({ note, onSave, onCancel }) => {\n    console.log('NoteEditor rendered with note:', note);\n\n    const [title, setTitle] = useState(note?.title || '');\n    const [content, setContent] = useState(note?.content || '');\n    const [category, setCategory] = useState(note?.category || '');\n    const [isSaving, setIsSaving] = React.useState(false);\n    const [collaborators, setCollaborators] = React.useState<CollaboratorState[]>([]);\n    const contentRef = useRef<HTMLTextAreaElement>(null);\n    const lastUpdateRef = useRef<number>(0);\n    const updateTimeoutRef = useRef<NodeJS.Timeout>();\n    const typingTimeoutRef = useRef<NodeJS.Timeout>();\n    const [undoStack, setUndoStack] = useState<HistoryEntry[]>([]);\n    const [redoStack, setRedoStack] = useState<HistoryEntry[]>([]);\n    const lastSavedRef = useRef<string>('');\n    const autoSaveTimeoutRef = useRef<NodeJS.Timeout>();\n    const [versions, setVersions] = useState<Version[]>([]);\n    const [showVersions, setShowVersions] = useState(false);\n    const [versionName, setVersionName] = useState('');\n\n    useEffect(() => {\n        if (note) {\n            // Editing existing note\n            setTitle(note.title);\n            setContent(note.content);\n            setCategory(note.category);\n            \n            // Enhanced collaborator tracking\n            signalRService.onCollaboratorJoined((username) => {\n                const color = getColorForUsername(username);\n                setCollaborators(prev => [...prev, { \n                    username, \n                    isTyping: false,\n                    color,\n                    cursorPosition: undefined,\n                    selection: undefined\n                }]);\n            });\n\n            signalRService.onCollaboratorLeft((username) => {\n                setCollaborators(prev => prev.filter(c => c.username !== username));\n            });\n\n            // Typing indicators\n            signalRService.onUserStartedTyping((username) => {\n                setCollaborators(prev => \n                    prev.map(c => c.username === username ? { ...c, isTyping: true } : c)\n                );\n            });\n\n            signalRService.onUserStoppedTyping((username) => {\n                setCollaborators(prev => \n                    prev.map(c => c.username === username ? { ...c, isTyping: false } : c)\n                );\n            });\n\n            // Cursor tracking\n            signalRService.onCursorMoved((username, position) => {\n                setCollaborators(prev => \n                    prev.map(c => c.username === username ? { ...c, cursorPosition: position } : c)\n                );\n                showCollaboratorCursor(username, position);\n            });\n        } else {\n            // Creating new note\n            setTitle('');\n            setContent('');\n            setCategory('');\n        }\n\n        return () => {\n            if (note) {\n                console.log('NoteEditor unmounting');\n            }\n            if (typingTimeoutRef.current) {\n                clearTimeout(typingTimeoutRef.current);\n            }\n        };\n    }, [note?.id]);\n\n    const showCollaboratorCursor = (username: string, position: number) => {\n        if (!contentRef.current) return;\n\n        const existingCursor = document.querySelector(`.collaborator-cursor-${username}`);\n        existingCursor?.remove();\n\n        const cursor = document.createElement('div');\n        cursor.className = `collaborator-cursor collaborator-cursor-${username}`;\n        cursor.setAttribute('data-username', username);\n        cursor.style.color = getColorForUsername(username);\n\n        const { top, left } = calculateCursorPosition(position);\n        cursor.style.top = `${top}px`;\n        cursor.style.left = `${left}px`;\n\n        contentRef.current.parentElement?.appendChild(cursor);\n        setTimeout(() => cursor.remove(), 2000);\n    };\n\n    const calculateCursorPosition = (position: number) => {\n        if (!contentRef.current) return { top: 0, left: 0 };\n\n        const textArea = contentRef.current;\n        const textBeforeCursor = content.substring(0, position);\n        const lines = textBeforeCursor.split('\\n');\n        const lineHeight = 20; // Approximate line height\n        const charWidth = 8; // Approximate character width\n\n        return {\n            top: (lines.length - 1) * lineHeight,\n            left: lines[lines.length - 1].length * charWidth\n        };\n    };\n\n    const getColorForUsername = (username: string) => {\n        const colors = ['#2196f3', '#4caf50', '#f44336', '#ff9800', '#9c27b0'];\n        let hash = 0;\n        for (let i = 0; i < username.length; i++) {\n            hash = username.charCodeAt(i) + ((hash << 5) - hash);\n        }\n        return colors[Math.abs(hash) % colors.length];\n    };\n\n    const handleContentChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {\n        const newContent = e.target.value;\n        setContent(newContent);\n\n        // Notify typing started\n        if (note) {\n            signalRService.notifyTypingStarted(note.id);\n            \n            // Clear existing timeout\n            if (typingTimeoutRef.current) {\n                clearTimeout(typingTimeoutRef.current);\n            }\n\n            // Set new timeout to notify typing stopped\n            typingTimeoutRef.current = setTimeout(() => {\n                if (note) {\n                    signalRService.notifyTypingStopped(note.id);\n                }\n            }, 1000);\n\n            // Throttle content updates\n            const now = Date.now();\n            if (now - lastUpdateRef.current > 500) {\n                signalRService.updateNote(note.id, newContent);\n                lastUpdateRef.current = now;\n            } else {\n                if (updateTimeoutRef.current) {\n                    clearTimeout(updateTimeoutRef.current);\n                }\n                updateTimeoutRef.current = setTimeout(() => {\n                    signalRService.updateNote(note.id, newContent);\n                    lastUpdateRef.current = Date.now();\n                }, 500);\n            }\n        }\n    };\n\n    const updateCursorPosition = () => {\n        if (!note || !contentRef.current) return;\n        const textarea = contentRef.current;\n        const cursorPosition = textarea.selectionStart;\n        signalRService.updateCursorPosition(note.id, cursorPosition);\n    };\n\n    const handleMouseMove = (e: React.MouseEvent<HTMLTextAreaElement>) => {\n        updateCursorPosition();\n    };\n\n    const handleKeyUp = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {\n        updateCursorPosition();\n    };\n\n    const handleSave = async () => {\n        try {\n            setIsSaving(true);\n            await onSave({\n                ...(note || {}),\n                title,\n                content,\n                category\n            });\n        } finally {\n            setIsSaving(false);\n        }\n    };\n\n    // Add selection tracking\n    const handleSelectionChange = () => {\n        if (!note || !contentRef.current) return;\n        \n        const textarea = contentRef.current;\n        const selection = {\n            start: textarea.selectionStart,\n            end: textarea.selectionEnd\n        };\n\n        if (selection.start !== selection.end) {\n            signalRService.updateSelection(note.id, selection);\n        }\n    };\n\n    // Add undo/redo handling\n    const addToHistory = (content: string) => {\n        if (!contentRef.current) return;\n\n        setUndoStack(prev => [...prev, {\n            content,\n            cursorPosition: contentRef.current?.selectionStart ?? 0\n        }]);\n        setRedoStack([]);\n    };\n\n    const undo = () => {\n        if (undoStack.length === 0) return;\n\n        const current = {\n            content,\n            cursorPosition: contentRef.current?.selectionStart ?? 0\n        };\n        const previous = undoStack[undoStack.length - 1];\n\n        setRedoStack(prev => [...prev, current]);\n        setUndoStack(prev => prev.slice(0, -1));\n        setContent(previous.content);\n\n        if (contentRef.current) {\n            contentRef.current.selectionStart = previous.cursorPosition;\n            contentRef.current.selectionEnd = previous.cursorPosition;\n        }\n\n        if (note) {\n            signalRService.updateNote(note.id, previous.content);\n        }\n    };\n\n    const redo = () => {\n        if (redoStack.length === 0) return;\n\n        const current = {\n            content,\n            cursorPosition: contentRef.current?.selectionStart ?? 0\n        };\n        const next = redoStack[redoStack.length - 1];\n\n        setUndoStack(prev => [...prev, current]);\n        setRedoStack(prev => prev.slice(0, -1));\n        setContent(next.content);\n\n        if (contentRef.current) {\n            contentRef.current.selectionStart = next.cursorPosition;\n            contentRef.current.selectionEnd = next.cursorPosition;\n        }\n\n        if (note) {\n            signalRService.updateNote(note.id, next.content);\n        }\n    };\n\n    // Add auto-save functionality\n    useEffect(() => {\n        if (note && content !== lastSavedRef.current) {\n            if (autoSaveTimeoutRef.current) {\n                clearTimeout(autoSaveTimeoutRef.current);\n            }\n\n            // Instead of auto-saving, just update via SignalR for collaboration\n            if (note.id) {\n                autoSaveTimeoutRef.current = setTimeout(() => {\n                    signalRService.updateNote(note.id, content);\n                    lastSavedRef.current = content;\n                }, 3000);\n            }\n        }\n\n        return () => {\n            if (autoSaveTimeoutRef.current) {\n                clearTimeout(autoSaveTimeoutRef.current);\n            }\n        };\n    }, [content, note]);\n\n    // Add keyboard shortcuts\n    useEffect(() => {\n        const handleKeyDown = (e: KeyboardEvent) => {\n            if ((e.ctrlKey || e.metaKey) && e.key === 'z') {\n                e.preventDefault();\n                if (e.shiftKey) {\n                    redo();\n                } else {\n                    undo();\n                }\n            }\n        };\n\n        document.addEventListener('keydown', handleKeyDown);\n        return () => document.removeEventListener('keydown', handleKeyDown);\n    }, [undo, redo]);\n\n    // Add version saving functionality\n    const handleSaveVersion = async () => {\n        if (!note || !versionName.trim()) return;\n        \n        try {\n            await signalRService.saveVersion(note.id, content, versionName);\n            setVersionName('');\n            // Version list will be updated via SignalR\n        } catch (err) {\n            console.error('Failed to save version:', err);\n        }\n    };\n\n    // Add version loading functionality\n    const loadVersion = (version: Version) => {\n        setContent(version.content);\n        if (note) {\n            signalRService.updateNote(note.id, version.content);\n        }\n    };\n\n    // Add logging to form submission\n    const handleSubmit = async (e: React.FormEvent) => {\n        e.preventDefault();\n        console.log('Form submitted');\n        await onSave({\n            id: note?.id,\n            title,\n            content,\n            category,\n            userId: note?.userId\n        });\n    };\n\n    return (\n        <form onSubmit={handleSubmit} className=\"note-editor\">\n            <h2>{note ? 'Edit Note' : 'Create Note'}</h2>\n            {collaborators.length > 0 && (\n                <div className=\"collaborators\">\n                    <span>Currently editing: </span>\n                    {collaborators.map(collaborator => (\n                        <span \n                            key={collaborator.username} \n                            className={`collaborator-badge ${collaborator.isTyping ? 'typing' : ''}`}\n                            style={{ backgroundColor: getColorForUsername(collaborator.username) }}\n                        >\n                            {collaborator.username}\n                            {collaborator.isTyping && <span className=\"typing-indicator\" />}\n                        </span>\n                    ))}\n                </div>\n            )}\n            <input\n                type=\"text\"\n                placeholder=\"Title\"\n                value={title}\n                onChange={(e) => setTitle(e.target.value)}\n            />\n            <input\n                type=\"text\"\n                placeholder=\"Category\"\n                value={category}\n                onChange={(e) => setCategory(e.target.value)}\n            />\n            <div className=\"editor-toolbar\">\n                <button onClick={undo} disabled={undoStack.length === 0}>\n                    Undo\n                </button>\n                <button onClick={redo} disabled={redoStack.length === 0}>\n                    Redo\n                </button>\n                <button onClick={() => setShowVersions(!showVersions)}>\n                    {showVersions ? 'Hide Versions' : 'Show Versions'}\n                </button>\n            </div>\n            \n            {showVersions && (\n                <div className=\"version-panel\">\n                    <div className=\"version-header\">\n                        <input\n                            type=\"text\"\n                            placeholder=\"Version name\"\n                            value={versionName}\n                            onChange={(e) => setVersionName(e.target.value)}\n                        />\n                        <button \n                            onClick={handleSaveVersion}\n                            disabled={!versionName.trim()}\n                        >\n                            Save Version\n                        </button>\n                    </div>\n                    <div className=\"version-list\">\n                        {versions.map(version => (\n                            <div \n                                key={version.id}\n                                className=\"version-item\"\n                                onClick={() => loadVersion(version)}\n                            >\n                                <span className=\"version-name\">{version.name}</span>\n                                <span className=\"version-date\">\n                                    {new Date(version.createdAt).toLocaleString()}\n                                </span>\n                            </div>\n                        ))}\n                    </div>\n                </div>\n            )}\n            <textarea\n                ref={contentRef}\n                placeholder=\"Note content...\"\n                value={content}\n                onChange={handleContentChange}\n                onClick={handleMouseMove}\n                onKeyUp={handleKeyUp}\n                onSelect={handleSelectionChange}\n            />\n            <div className=\"button-group\">\n                <button \n                    onClick={handleSave}\n                    disabled={isSaving}\n                >\n                    {isSaving ? 'Saving...' : (note ? 'Save' : 'Create')}\n                </button>\n                <button onClick={onCancel}>Cancel</button>\n            </div>\n        </form>\n    );\n};\n\nexport default NoteEditor;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}