{"ast":null,"code":"var _jsxFileName = \"D:\\\\_master\\\\v5\\\\notepad-plus\\\\src\\\\components\\\\NoteEditor.tsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from 'react';\nimport { signalRService } from '../services/signalR';\nimport './NoteEditor.css'; // Make sure this is the exact path\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst NoteEditor = ({\n  note,\n  onSave,\n  onCancel\n}) => {\n  _s();\n  console.log('NoteEditor rendered with note:', note);\n  const [title, setTitle] = useState((note === null || note === void 0 ? void 0 : note.title) || '');\n  const [content, setContent] = useState((note === null || note === void 0 ? void 0 : note.content) || '');\n  const [category, setCategory] = useState((note === null || note === void 0 ? void 0 : note.category) || '');\n  const [isSaving, setIsSaving] = React.useState(false);\n  const [collaborators, setCollaborators] = React.useState([]);\n  const contentRef = useRef(null);\n  const lastUpdateRef = useRef(0);\n  const updateTimeoutRef = useRef();\n  const typingTimeoutRef = useRef();\n  const [undoStack, setUndoStack] = useState([]);\n  const [redoStack, setRedoStack] = useState([]);\n  const lastSavedRef = useRef('');\n  const autoSaveTimeoutRef = useRef();\n  const [versions, setVersions] = useState([]);\n  const [showVersions, setShowVersions] = useState(false);\n  const [versionName, setVersionName] = useState('');\n  useEffect(() => {\n    if (note) {\n      // Editing existing note\n      setTitle(note.title);\n      setContent(note.content);\n      setCategory(note.category);\n\n      // Join the note's SignalR group\n      signalRService.joinNote(note.id);\n\n      // Listen for updates from other users\n      signalRService.onNoteUpdated((noteId, updatedContent) => {\n        if (noteId === note.id) {\n          setContent(updatedContent);\n        }\n      });\n\n      // Enhanced collaborator tracking\n      signalRService.onCollaboratorJoined(username => {\n        const color = getColorForUsername(username);\n        setCollaborators(prev => [...prev, {\n          username,\n          isTyping: false,\n          color,\n          cursorPosition: undefined,\n          selection: undefined\n        }]);\n      });\n      signalRService.onCollaboratorLeft(username => {\n        setCollaborators(prev => prev.filter(c => c.username !== username));\n      });\n\n      // Typing indicators\n      signalRService.onUserStartedTyping(username => {\n        setCollaborators(prev => prev.map(c => c.username === username ? {\n          ...c,\n          isTyping: true\n        } : c));\n      });\n      signalRService.onUserStoppedTyping(username => {\n        setCollaborators(prev => prev.map(c => c.username === username ? {\n          ...c,\n          isTyping: false\n        } : c));\n      });\n\n      // Cursor tracking\n      signalRService.onCursorMoved((username, position) => {\n        setCollaborators(prev => prev.map(c => c.username === username ? {\n          ...c,\n          cursorPosition: position\n        } : c));\n        showCollaboratorCursor(username, position);\n      });\n    } else {\n      // Creating new note\n      setTitle('');\n      setContent('');\n      setCategory('');\n    }\n    return () => {\n      if (note) {\n        signalRService.leaveNote(note.id);\n        signalRService.removeAllHandlers(); // Clean up event handlers\n      }\n      if (typingTimeoutRef.current) {\n        clearTimeout(typingTimeoutRef.current);\n      }\n      console.log('NoteEditor unmounting');\n    };\n  }, [note === null || note === void 0 ? void 0 : note.id]);\n  const showCollaboratorCursor = (username, position) => {\n    var _contentRef$current$p;\n    if (!contentRef.current) return;\n    const existingCursor = document.querySelector(`.collaborator-cursor-${username}`);\n    existingCursor === null || existingCursor === void 0 ? void 0 : existingCursor.remove();\n    const cursor = document.createElement('div');\n    cursor.className = `collaborator-cursor collaborator-cursor-${username}`;\n    cursor.setAttribute('data-username', username);\n    cursor.style.color = getColorForUsername(username);\n    const {\n      top,\n      left\n    } = calculateCursorPosition(position);\n    cursor.style.top = `${top}px`;\n    cursor.style.left = `${left}px`;\n    (_contentRef$current$p = contentRef.current.parentElement) === null || _contentRef$current$p === void 0 ? void 0 : _contentRef$current$p.appendChild(cursor);\n    setTimeout(() => cursor.remove(), 2000);\n  };\n  const calculateCursorPosition = position => {\n    if (!contentRef.current) return {\n      top: 0,\n      left: 0\n    };\n    const textArea = contentRef.current;\n    const textBeforeCursor = content.substring(0, position);\n    const lines = textBeforeCursor.split('\\n');\n    const lineHeight = 20; // Approximate line height\n    const charWidth = 8; // Approximate character width\n\n    return {\n      top: (lines.length - 1) * lineHeight,\n      left: lines[lines.length - 1].length * charWidth\n    };\n  };\n  const getColorForUsername = username => {\n    const colors = ['#2196f3', '#4caf50', '#f44336', '#ff9800', '#9c27b0'];\n    let hash = 0;\n    for (let i = 0; i < username.length; i++) {\n      hash = username.charCodeAt(i) + ((hash << 5) - hash);\n    }\n    return colors[Math.abs(hash) % colors.length];\n  };\n  const handleContentChange = e => {\n    const newContent = e.target.value;\n    setContent(newContent);\n\n    // Notify typing started\n    if (note) {\n      signalRService.notifyTypingStarted(note.id);\n\n      // Clear existing timeout\n      if (typingTimeoutRef.current) {\n        clearTimeout(typingTimeoutRef.current);\n      }\n\n      // Set new timeout to notify typing stopped\n      typingTimeoutRef.current = setTimeout(() => {\n        if (note) {\n          signalRService.notifyTypingStopped(note.id);\n        }\n      }, 1000);\n\n      // Throttle content updates\n      const now = Date.now();\n      if (now - lastUpdateRef.current > 500) {\n        signalRService.updateNote(note.id, newContent);\n        lastUpdateRef.current = now;\n      } else {\n        if (updateTimeoutRef.current) {\n          clearTimeout(updateTimeoutRef.current);\n        }\n        updateTimeoutRef.current = setTimeout(() => {\n          signalRService.updateNote(note.id, newContent);\n          lastUpdateRef.current = Date.now();\n        }, 500);\n      }\n    }\n  };\n  const updateCursorPosition = () => {\n    if (!note || !contentRef.current) return;\n    const textarea = contentRef.current;\n    const cursorPosition = textarea.selectionStart;\n    signalRService.updateCursorPosition(note.id, cursorPosition);\n  };\n  const handleMouseMove = e => {\n    updateCursorPosition();\n  };\n  const handleKeyUp = e => {\n    updateCursorPosition();\n  };\n  const handleSave = async () => {\n    try {\n      setIsSaving(true);\n      await onSave({\n        ...(note || {}),\n        // Spread existing note if editing, empty object if creating\n        title,\n        content,\n        category\n      });\n      if (!note) {\n        // Clear form after creating new note\n        setTitle('');\n        setContent('');\n        setCategory('');\n      }\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  // Add selection tracking\n  const handleSelectionChange = () => {\n    if (!note || !contentRef.current) return;\n    const textarea = contentRef.current;\n    const selection = {\n      start: textarea.selectionStart,\n      end: textarea.selectionEnd\n    };\n    if (selection.start !== selection.end) {\n      signalRService.updateSelection(note.id, selection);\n    }\n  };\n\n  // Add undo/redo handling\n  const addToHistory = content => {\n    if (!contentRef.current) return;\n    setUndoStack(prev => {\n      var _contentRef$current$s, _contentRef$current;\n      return [...prev, {\n        content,\n        cursorPosition: (_contentRef$current$s = (_contentRef$current = contentRef.current) === null || _contentRef$current === void 0 ? void 0 : _contentRef$current.selectionStart) !== null && _contentRef$current$s !== void 0 ? _contentRef$current$s : 0\n      }];\n    });\n    setRedoStack([]);\n  };\n  const undo = () => {\n    var _contentRef$current$s2, _contentRef$current2;\n    if (undoStack.length === 0) return;\n    const current = {\n      content,\n      cursorPosition: (_contentRef$current$s2 = (_contentRef$current2 = contentRef.current) === null || _contentRef$current2 === void 0 ? void 0 : _contentRef$current2.selectionStart) !== null && _contentRef$current$s2 !== void 0 ? _contentRef$current$s2 : 0\n    };\n    const previous = undoStack[undoStack.length - 1];\n    setRedoStack(prev => [...prev, current]);\n    setUndoStack(prev => prev.slice(0, -1));\n    setContent(previous.content);\n    if (contentRef.current) {\n      contentRef.current.selectionStart = previous.cursorPosition;\n      contentRef.current.selectionEnd = previous.cursorPosition;\n    }\n    if (note) {\n      signalRService.updateNote(note.id, previous.content);\n    }\n  };\n  const redo = () => {\n    var _contentRef$current$s3, _contentRef$current3;\n    if (redoStack.length === 0) return;\n    const current = {\n      content,\n      cursorPosition: (_contentRef$current$s3 = (_contentRef$current3 = contentRef.current) === null || _contentRef$current3 === void 0 ? void 0 : _contentRef$current3.selectionStart) !== null && _contentRef$current$s3 !== void 0 ? _contentRef$current$s3 : 0\n    };\n    const next = redoStack[redoStack.length - 1];\n    setUndoStack(prev => [...prev, current]);\n    setRedoStack(prev => prev.slice(0, -1));\n    setContent(next.content);\n    if (contentRef.current) {\n      contentRef.current.selectionStart = next.cursorPosition;\n      contentRef.current.selectionEnd = next.cursorPosition;\n    }\n    if (note) {\n      signalRService.updateNote(note.id, next.content);\n    }\n  };\n\n  // Add auto-save functionality\n  useEffect(() => {\n    if (note && content !== lastSavedRef.current) {\n      if (autoSaveTimeoutRef.current) {\n        clearTimeout(autoSaveTimeoutRef.current);\n      }\n      autoSaveTimeoutRef.current = setTimeout(() => {\n        handleSave();\n        lastSavedRef.current = content;\n      }, 3000); // Auto-save after 3 seconds of no changes\n    }\n    return () => {\n      if (autoSaveTimeoutRef.current) {\n        clearTimeout(autoSaveTimeoutRef.current);\n      }\n    };\n  }, [content, note]);\n\n  // Add keyboard shortcuts\n  useEffect(() => {\n    const handleKeyDown = e => {\n      if ((e.ctrlKey || e.metaKey) && e.key === 'z') {\n        e.preventDefault();\n        if (e.shiftKey) {\n          redo();\n        } else {\n          undo();\n        }\n      }\n    };\n    document.addEventListener('keydown', handleKeyDown);\n    return () => document.removeEventListener('keydown', handleKeyDown);\n  }, [undo, redo]);\n\n  // Add version saving functionality\n  const handleSaveVersion = async () => {\n    if (!note || !versionName.trim()) return;\n    try {\n      await signalRService.saveVersion(note.id, content, versionName);\n      setVersionName('');\n      // Version list will be updated via SignalR\n    } catch (err) {\n      console.error('Failed to save version:', err);\n    }\n  };\n\n  // Add version loading functionality\n  const loadVersion = version => {\n    setContent(version.content);\n    if (note) {\n      signalRService.updateNote(note.id, version.content);\n    }\n  };\n\n  // Add logging to form submission\n  const handleSubmit = async e => {\n    e.preventDefault();\n    console.log('Form submitted');\n    await onSave({\n      id: note === null || note === void 0 ? void 0 : note.id,\n      title,\n      content,\n      category,\n      userId: note === null || note === void 0 ? void 0 : note.userId\n    });\n  };\n  return /*#__PURE__*/_jsxDEV(\"form\", {\n    onSubmit: handleSubmit,\n    className: \"note-editor\",\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: note ? 'Edit Note' : 'Create Note'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 389,\n      columnNumber: 13\n    }, this), collaborators.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"collaborators\",\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        children: \"Currently editing: \"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 392,\n        columnNumber: 21\n      }, this), collaborators.map(collaborator => /*#__PURE__*/_jsxDEV(\"span\", {\n        className: `collaborator-badge ${collaborator.isTyping ? 'typing' : ''}`,\n        style: {\n          backgroundColor: getColorForUsername(collaborator.username)\n        },\n        children: [collaborator.username, collaborator.isTyping && /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"typing-indicator\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 400,\n          columnNumber: 55\n        }, this)]\n      }, collaborator.username, true, {\n        fileName: _jsxFileName,\n        lineNumber: 394,\n        columnNumber: 25\n      }, this))]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 391,\n      columnNumber: 17\n    }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n      type: \"text\",\n      placeholder: \"Title\",\n      value: title,\n      onChange: e => setTitle(e.target.value)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 405,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n      type: \"text\",\n      placeholder: \"Category\",\n      value: category,\n      onChange: e => setCategory(e.target.value)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 411,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"editor-toolbar\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: undo,\n        disabled: undoStack.length === 0,\n        children: \"Undo\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 418,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: redo,\n        disabled: redoStack.length === 0,\n        children: \"Redo\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 421,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => setShowVersions(!showVersions),\n        children: showVersions ? 'Hide Versions' : 'Show Versions'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 424,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 417,\n      columnNumber: 13\n    }, this), showVersions && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"version-panel\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"version-header\",\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          placeholder: \"Version name\",\n          value: versionName,\n          onChange: e => setVersionName(e.target.value)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 432,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleSaveVersion,\n          disabled: !versionName.trim(),\n          children: \"Save Version\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 438,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 431,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"version-list\",\n        children: versions.map(version => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"version-item\",\n          onClick: () => loadVersion(version),\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"version-name\",\n            children: version.name\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 452,\n            columnNumber: 33\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"version-date\",\n            children: new Date(version.createdAt).toLocaleString()\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 453,\n            columnNumber: 33\n          }, this)]\n        }, version.id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 447,\n          columnNumber: 29\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 445,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 430,\n      columnNumber: 17\n    }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n      ref: contentRef,\n      placeholder: \"Note content...\",\n      value: content,\n      onChange: handleContentChange,\n      onClick: handleMouseMove,\n      onKeyUp: handleKeyUp,\n      onSelect: handleSelectionChange\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 461,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"button-group\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleSave,\n        disabled: isSaving,\n        children: isSaving ? 'Saving...' : note ? 'Save' : 'Create'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 471,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: onCancel,\n        children: \"Cancel\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 477,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 470,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 388,\n    columnNumber: 9\n  }, this);\n};\n_s(NoteEditor, \"ixW2omToCFLTGVr61PH3v7i/eKk=\");\n_c = NoteEditor;\nexport default NoteEditor;\nvar _c;\n$RefreshReg$(_c, \"NoteEditor\");","map":{"version":3,"names":["React","useEffect","useRef","useState","signalRService","jsxDEV","_jsxDEV","NoteEditor","note","onSave","onCancel","_s","console","log","title","setTitle","content","setContent","category","setCategory","isSaving","setIsSaving","collaborators","setCollaborators","contentRef","lastUpdateRef","updateTimeoutRef","typingTimeoutRef","undoStack","setUndoStack","redoStack","setRedoStack","lastSavedRef","autoSaveTimeoutRef","versions","setVersions","showVersions","setShowVersions","versionName","setVersionName","joinNote","id","onNoteUpdated","noteId","updatedContent","onCollaboratorJoined","username","color","getColorForUsername","prev","isTyping","cursorPosition","undefined","selection","onCollaboratorLeft","filter","c","onUserStartedTyping","map","onUserStoppedTyping","onCursorMoved","position","showCollaboratorCursor","leaveNote","removeAllHandlers","current","clearTimeout","_contentRef$current$p","existingCursor","document","querySelector","remove","cursor","createElement","className","setAttribute","style","top","left","calculateCursorPosition","parentElement","appendChild","setTimeout","textArea","textBeforeCursor","substring","lines","split","lineHeight","charWidth","length","colors","hash","i","charCodeAt","Math","abs","handleContentChange","e","newContent","target","value","notifyTypingStarted","notifyTypingStopped","now","Date","updateNote","updateCursorPosition","textarea","selectionStart","handleMouseMove","handleKeyUp","handleSave","handleSelectionChange","start","end","selectionEnd","updateSelection","addToHistory","_contentRef$current$s","_contentRef$current","undo","_contentRef$current$s2","_contentRef$current2","previous","slice","redo","_contentRef$current$s3","_contentRef$current3","next","handleKeyDown","ctrlKey","metaKey","key","preventDefault","shiftKey","addEventListener","removeEventListener","handleSaveVersion","trim","saveVersion","err","error","loadVersion","version","handleSubmit","userId","onSubmit","children","fileName","_jsxFileName","lineNumber","columnNumber","collaborator","backgroundColor","type","placeholder","onChange","onClick","disabled","name","createdAt","toLocaleString","ref","onKeyUp","onSelect","_c","$RefreshReg$"],"sources":["D:/_master/v5/notepad-plus/src/components/NoteEditor.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport { Note } from '../types/Note';\nimport { signalRService } from '../services/signalR';\nimport './NoteEditor.css';  // Make sure this is the exact path\n\ninterface NoteEditorProps {\n    note?: Note;\n    onSave: (note: Partial<Note>) => Promise<void>;\n    onCancel: () => void;\n}\n\ninterface Selection {\n    start: number;\n    end: number;\n}\n\ninterface CollaboratorState {\n    username: string;\n    isTyping: boolean;\n    cursorPosition?: number;\n    selection?: Selection;\n    color: string;\n}\n\ninterface HistoryEntry {\n    content: string;\n    cursorPosition: number;\n}\n\ninterface Version {\n    id: string;\n    content: string;\n    createdAt: Date;\n    name: string;\n}\n\nconst NoteEditor: React.FC<NoteEditorProps> = ({ note, onSave, onCancel }) => {\n    console.log('NoteEditor rendered with note:', note);\n\n    const [title, setTitle] = useState(note?.title || '');\n    const [content, setContent] = useState(note?.content || '');\n    const [category, setCategory] = useState(note?.category || '');\n    const [isSaving, setIsSaving] = React.useState(false);\n    const [collaborators, setCollaborators] = React.useState<CollaboratorState[]>([]);\n    const contentRef = useRef<HTMLTextAreaElement>(null);\n    const lastUpdateRef = useRef<number>(0);\n    const updateTimeoutRef = useRef<NodeJS.Timeout>();\n    const typingTimeoutRef = useRef<NodeJS.Timeout>();\n    const [undoStack, setUndoStack] = useState<HistoryEntry[]>([]);\n    const [redoStack, setRedoStack] = useState<HistoryEntry[]>([]);\n    const lastSavedRef = useRef<string>('');\n    const autoSaveTimeoutRef = useRef<NodeJS.Timeout>();\n    const [versions, setVersions] = useState<Version[]>([]);\n    const [showVersions, setShowVersions] = useState(false);\n    const [versionName, setVersionName] = useState('');\n\n    useEffect(() => {\n        if (note) {\n            // Editing existing note\n            setTitle(note.title);\n            setContent(note.content);\n            setCategory(note.category);\n            \n            // Join the note's SignalR group\n            signalRService.joinNote(note.id);\n\n            // Listen for updates from other users\n            signalRService.onNoteUpdated((noteId, updatedContent) => {\n                if (noteId === note.id) {\n                    setContent(updatedContent);\n                }\n            });\n\n            // Enhanced collaborator tracking\n            signalRService.onCollaboratorJoined((username) => {\n                const color = getColorForUsername(username);\n                setCollaborators(prev => [...prev, { \n                    username, \n                    isTyping: false,\n                    color,\n                    cursorPosition: undefined,\n                    selection: undefined\n                }]);\n            });\n\n            signalRService.onCollaboratorLeft((username) => {\n                setCollaborators(prev => prev.filter(c => c.username !== username));\n            });\n\n            // Typing indicators\n            signalRService.onUserStartedTyping((username) => {\n                setCollaborators(prev => \n                    prev.map(c => c.username === username ? { ...c, isTyping: true } : c)\n                );\n            });\n\n            signalRService.onUserStoppedTyping((username) => {\n                setCollaborators(prev => \n                    prev.map(c => c.username === username ? { ...c, isTyping: false } : c)\n                );\n            });\n\n            // Cursor tracking\n            signalRService.onCursorMoved((username, position) => {\n                setCollaborators(prev => \n                    prev.map(c => c.username === username ? { ...c, cursorPosition: position } : c)\n                );\n                showCollaboratorCursor(username, position);\n            });\n        } else {\n            // Creating new note\n            setTitle('');\n            setContent('');\n            setCategory('');\n        }\n\n        return () => {\n            if (note) {\n                signalRService.leaveNote(note.id);\n                signalRService.removeAllHandlers(); // Clean up event handlers\n            }\n            if (typingTimeoutRef.current) {\n                clearTimeout(typingTimeoutRef.current);\n            }\n            console.log('NoteEditor unmounting');\n        };\n    }, [note?.id]);\n\n    const showCollaboratorCursor = (username: string, position: number) => {\n        if (!contentRef.current) return;\n\n        const existingCursor = document.querySelector(`.collaborator-cursor-${username}`);\n        existingCursor?.remove();\n\n        const cursor = document.createElement('div');\n        cursor.className = `collaborator-cursor collaborator-cursor-${username}`;\n        cursor.setAttribute('data-username', username);\n        cursor.style.color = getColorForUsername(username);\n\n        const { top, left } = calculateCursorPosition(position);\n        cursor.style.top = `${top}px`;\n        cursor.style.left = `${left}px`;\n\n        contentRef.current.parentElement?.appendChild(cursor);\n        setTimeout(() => cursor.remove(), 2000);\n    };\n\n    const calculateCursorPosition = (position: number) => {\n        if (!contentRef.current) return { top: 0, left: 0 };\n\n        const textArea = contentRef.current;\n        const textBeforeCursor = content.substring(0, position);\n        const lines = textBeforeCursor.split('\\n');\n        const lineHeight = 20; // Approximate line height\n        const charWidth = 8; // Approximate character width\n\n        return {\n            top: (lines.length - 1) * lineHeight,\n            left: lines[lines.length - 1].length * charWidth\n        };\n    };\n\n    const getColorForUsername = (username: string) => {\n        const colors = ['#2196f3', '#4caf50', '#f44336', '#ff9800', '#9c27b0'];\n        let hash = 0;\n        for (let i = 0; i < username.length; i++) {\n            hash = username.charCodeAt(i) + ((hash << 5) - hash);\n        }\n        return colors[Math.abs(hash) % colors.length];\n    };\n\n    const handleContentChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {\n        const newContent = e.target.value;\n        setContent(newContent);\n\n        // Notify typing started\n        if (note) {\n            signalRService.notifyTypingStarted(note.id);\n            \n            // Clear existing timeout\n            if (typingTimeoutRef.current) {\n                clearTimeout(typingTimeoutRef.current);\n            }\n\n            // Set new timeout to notify typing stopped\n            typingTimeoutRef.current = setTimeout(() => {\n                if (note) {\n                    signalRService.notifyTypingStopped(note.id);\n                }\n            }, 1000);\n\n            // Throttle content updates\n            const now = Date.now();\n            if (now - lastUpdateRef.current > 500) {\n                signalRService.updateNote(note.id, newContent);\n                lastUpdateRef.current = now;\n            } else {\n                if (updateTimeoutRef.current) {\n                    clearTimeout(updateTimeoutRef.current);\n                }\n                updateTimeoutRef.current = setTimeout(() => {\n                    signalRService.updateNote(note.id, newContent);\n                    lastUpdateRef.current = Date.now();\n                }, 500);\n            }\n        }\n    };\n\n    const updateCursorPosition = () => {\n        if (!note || !contentRef.current) return;\n        const textarea = contentRef.current;\n        const cursorPosition = textarea.selectionStart;\n        signalRService.updateCursorPosition(note.id, cursorPosition);\n    };\n\n    const handleMouseMove = (e: React.MouseEvent<HTMLTextAreaElement>) => {\n        updateCursorPosition();\n    };\n\n    const handleKeyUp = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {\n        updateCursorPosition();\n    };\n\n    const handleSave = async () => {\n        try {\n            setIsSaving(true);\n            await onSave({\n                ...(note || {}), // Spread existing note if editing, empty object if creating\n                title,\n                content,\n                category\n            });\n            if (!note) {\n                // Clear form after creating new note\n                setTitle('');\n                setContent('');\n                setCategory('');\n            }\n        } finally {\n            setIsSaving(false);\n        }\n    };\n\n    // Add selection tracking\n    const handleSelectionChange = () => {\n        if (!note || !contentRef.current) return;\n        \n        const textarea = contentRef.current;\n        const selection = {\n            start: textarea.selectionStart,\n            end: textarea.selectionEnd\n        };\n\n        if (selection.start !== selection.end) {\n            signalRService.updateSelection(note.id, selection);\n        }\n    };\n\n    // Add undo/redo handling\n    const addToHistory = (content: string) => {\n        if (!contentRef.current) return;\n\n        setUndoStack(prev => [...prev, {\n            content,\n            cursorPosition: contentRef.current?.selectionStart ?? 0\n        }]);\n        setRedoStack([]);\n    };\n\n    const undo = () => {\n        if (undoStack.length === 0) return;\n\n        const current = {\n            content,\n            cursorPosition: contentRef.current?.selectionStart ?? 0\n        };\n        const previous = undoStack[undoStack.length - 1];\n\n        setRedoStack(prev => [...prev, current]);\n        setUndoStack(prev => prev.slice(0, -1));\n        setContent(previous.content);\n\n        if (contentRef.current) {\n            contentRef.current.selectionStart = previous.cursorPosition;\n            contentRef.current.selectionEnd = previous.cursorPosition;\n        }\n\n        if (note) {\n            signalRService.updateNote(note.id, previous.content);\n        }\n    };\n\n    const redo = () => {\n        if (redoStack.length === 0) return;\n\n        const current = {\n            content,\n            cursorPosition: contentRef.current?.selectionStart ?? 0\n        };\n        const next = redoStack[redoStack.length - 1];\n\n        setUndoStack(prev => [...prev, current]);\n        setRedoStack(prev => prev.slice(0, -1));\n        setContent(next.content);\n\n        if (contentRef.current) {\n            contentRef.current.selectionStart = next.cursorPosition;\n            contentRef.current.selectionEnd = next.cursorPosition;\n        }\n\n        if (note) {\n            signalRService.updateNote(note.id, next.content);\n        }\n    };\n\n    // Add auto-save functionality\n    useEffect(() => {\n        if (note && content !== lastSavedRef.current) {\n            if (autoSaveTimeoutRef.current) {\n                clearTimeout(autoSaveTimeoutRef.current);\n            }\n\n            autoSaveTimeoutRef.current = setTimeout(() => {\n                handleSave();\n                lastSavedRef.current = content;\n            }, 3000); // Auto-save after 3 seconds of no changes\n        }\n\n        return () => {\n            if (autoSaveTimeoutRef.current) {\n                clearTimeout(autoSaveTimeoutRef.current);\n            }\n        };\n    }, [content, note]);\n\n    // Add keyboard shortcuts\n    useEffect(() => {\n        const handleKeyDown = (e: KeyboardEvent) => {\n            if ((e.ctrlKey || e.metaKey) && e.key === 'z') {\n                e.preventDefault();\n                if (e.shiftKey) {\n                    redo();\n                } else {\n                    undo();\n                }\n            }\n        };\n\n        document.addEventListener('keydown', handleKeyDown);\n        return () => document.removeEventListener('keydown', handleKeyDown);\n    }, [undo, redo]);\n\n    // Add version saving functionality\n    const handleSaveVersion = async () => {\n        if (!note || !versionName.trim()) return;\n        \n        try {\n            await signalRService.saveVersion(note.id, content, versionName);\n            setVersionName('');\n            // Version list will be updated via SignalR\n        } catch (err) {\n            console.error('Failed to save version:', err);\n        }\n    };\n\n    // Add version loading functionality\n    const loadVersion = (version: Version) => {\n        setContent(version.content);\n        if (note) {\n            signalRService.updateNote(note.id, version.content);\n        }\n    };\n\n    // Add logging to form submission\n    const handleSubmit = async (e: React.FormEvent) => {\n        e.preventDefault();\n        console.log('Form submitted');\n        await onSave({\n            id: note?.id,\n            title,\n            content,\n            category,\n            userId: note?.userId\n        });\n    };\n\n    return (\n        <form onSubmit={handleSubmit} className=\"note-editor\">\n            <h2>{note ? 'Edit Note' : 'Create Note'}</h2>\n            {collaborators.length > 0 && (\n                <div className=\"collaborators\">\n                    <span>Currently editing: </span>\n                    {collaborators.map(collaborator => (\n                        <span \n                            key={collaborator.username} \n                            className={`collaborator-badge ${collaborator.isTyping ? 'typing' : ''}`}\n                            style={{ backgroundColor: getColorForUsername(collaborator.username) }}\n                        >\n                            {collaborator.username}\n                            {collaborator.isTyping && <span className=\"typing-indicator\" />}\n                        </span>\n                    ))}\n                </div>\n            )}\n            <input\n                type=\"text\"\n                placeholder=\"Title\"\n                value={title}\n                onChange={(e) => setTitle(e.target.value)}\n            />\n            <input\n                type=\"text\"\n                placeholder=\"Category\"\n                value={category}\n                onChange={(e) => setCategory(e.target.value)}\n            />\n            <div className=\"editor-toolbar\">\n                <button onClick={undo} disabled={undoStack.length === 0}>\n                    Undo\n                </button>\n                <button onClick={redo} disabled={redoStack.length === 0}>\n                    Redo\n                </button>\n                <button onClick={() => setShowVersions(!showVersions)}>\n                    {showVersions ? 'Hide Versions' : 'Show Versions'}\n                </button>\n            </div>\n            \n            {showVersions && (\n                <div className=\"version-panel\">\n                    <div className=\"version-header\">\n                        <input\n                            type=\"text\"\n                            placeholder=\"Version name\"\n                            value={versionName}\n                            onChange={(e) => setVersionName(e.target.value)}\n                        />\n                        <button \n                            onClick={handleSaveVersion}\n                            disabled={!versionName.trim()}\n                        >\n                            Save Version\n                        </button>\n                    </div>\n                    <div className=\"version-list\">\n                        {versions.map(version => (\n                            <div \n                                key={version.id}\n                                className=\"version-item\"\n                                onClick={() => loadVersion(version)}\n                            >\n                                <span className=\"version-name\">{version.name}</span>\n                                <span className=\"version-date\">\n                                    {new Date(version.createdAt).toLocaleString()}\n                                </span>\n                            </div>\n                        ))}\n                    </div>\n                </div>\n            )}\n            <textarea\n                ref={contentRef}\n                placeholder=\"Note content...\"\n                value={content}\n                onChange={handleContentChange}\n                onClick={handleMouseMove}\n                onKeyUp={handleKeyUp}\n                onSelect={handleSelectionChange}\n            />\n            <div className=\"button-group\">\n                <button \n                    onClick={handleSave}\n                    disabled={isSaving}\n                >\n                    {isSaving ? 'Saving...' : (note ? 'Save' : 'Create')}\n                </button>\n                <button onClick={onCancel}>Cancel</button>\n            </div>\n        </form>\n    );\n};\n\nexport default NoteEditor;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}