{"ast":null,"code":"var _jsxFileName = \"D:\\\\_master\\\\v5\\\\notepad-plus\\\\src\\\\components\\\\NoteEditor.tsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from 'react';\nimport { signalRService } from '../services/signalR';\nimport './NoteEditor.css'; // Make sure this is the exact path\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst NoteEditor = ({\n  note,\n  onSave,\n  onCancel\n}) => {\n  _s();\n  const [title, setTitle] = React.useState('');\n  const [content, setContent] = React.useState('');\n  const [category, setCategory] = React.useState('');\n  const [isSaving, setIsSaving] = React.useState(false);\n  const [collaborators, setCollaborators] = React.useState([]);\n  const contentRef = useRef(null);\n  const lastUpdateRef = useRef(0);\n  const updateTimeoutRef = useRef();\n  const typingTimeoutRef = useRef();\n  const [undoStack, setUndoStack] = useState([]);\n  const [redoStack, setRedoStack] = useState([]);\n  const lastSavedRef = useRef('');\n  const autoSaveTimeoutRef = useRef();\n  const [versions, setVersions] = useState([]);\n  const [showVersions, setShowVersions] = useState(false);\n  const [versionName, setVersionName] = useState('');\n  useEffect(() => {\n    if (note) {\n      // Editing existing note\n      setTitle(note.title);\n      setContent(note.content);\n      setCategory(note.category);\n\n      // Join the note's SignalR group\n      signalRService.joinNote(note.id);\n\n      // Listen for updates from other users\n      signalRService.onNoteUpdated((noteId, updatedContent) => {\n        if (noteId === note.id) {\n          setContent(updatedContent);\n        }\n      });\n\n      // Enhanced collaborator tracking\n      signalRService.onCollaboratorJoined(username => {\n        setCollaborators(prev => [...prev, {\n          username,\n          isTyping: false\n        }]);\n      });\n      signalRService.onCollaboratorLeft(username => {\n        setCollaborators(prev => prev.filter(c => c.username !== username));\n      });\n\n      // Typing indicators\n      signalRService.onUserStartedTyping(username => {\n        setCollaborators(prev => prev.map(c => c.username === username ? {\n          ...c,\n          isTyping: true\n        } : c));\n      });\n      signalRService.onUserStoppedTyping(username => {\n        setCollaborators(prev => prev.map(c => c.username === username ? {\n          ...c,\n          isTyping: false\n        } : c));\n      });\n\n      // Cursor tracking\n      signalRService.onCursorMoved((username, position) => {\n        setCollaborators(prev => prev.map(c => c.username === username ? {\n          ...c,\n          cursorPosition: position\n        } : c));\n        showCollaboratorCursor(username, position);\n      });\n    } else {\n      // Creating new note\n      setTitle('');\n      setContent('');\n      setCategory('');\n    }\n    return () => {\n      if (note) {\n        signalRService.leaveNote(note.id);\n        signalRService.removeAllHandlers(); // Clean up event handlers\n      }\n      if (typingTimeoutRef.current) {\n        clearTimeout(typingTimeoutRef.current);\n      }\n    };\n  }, [note === null || note === void 0 ? void 0 : note.id]);\n  const showCollaboratorCursor = (username, position) => {\n    var _contentRef$current$p;\n    if (!contentRef.current) return;\n    const existingCursor = document.querySelector(`.collaborator-cursor-${username}`);\n    existingCursor === null || existingCursor === void 0 ? void 0 : existingCursor.remove();\n    const cursor = document.createElement('div');\n    cursor.className = `collaborator-cursor collaborator-cursor-${username}`;\n    cursor.setAttribute('data-username', username);\n    cursor.style.color = getColorForUsername(username);\n    const {\n      top,\n      left\n    } = calculateCursorPosition(position);\n    cursor.style.top = `${top}px`;\n    cursor.style.left = `${left}px`;\n    (_contentRef$current$p = contentRef.current.parentElement) === null || _contentRef$current$p === void 0 ? void 0 : _contentRef$current$p.appendChild(cursor);\n    setTimeout(() => cursor.remove(), 2000);\n  };\n  const calculateCursorPosition = position => {\n    if (!contentRef.current) return {\n      top: 0,\n      left: 0\n    };\n    const textArea = contentRef.current;\n    const textBeforeCursor = content.substring(0, position);\n    const lines = textBeforeCursor.split('\\n');\n    const lineHeight = 20; // Approximate line height\n    const charWidth = 8; // Approximate character width\n\n    return {\n      top: (lines.length - 1) * lineHeight,\n      left: lines[lines.length - 1].length * charWidth\n    };\n  };\n  const getColorForUsername = username => {\n    const colors = ['#2196f3', '#4caf50', '#f44336', '#ff9800', '#9c27b0'];\n    let hash = 0;\n    for (let i = 0; i < username.length; i++) {\n      hash = username.charCodeAt(i) + ((hash << 5) - hash);\n    }\n    return colors[Math.abs(hash) % colors.length];\n  };\n  const handleContentChange = e => {\n    const newContent = e.target.value;\n    setContent(newContent);\n\n    // Notify typing started\n    if (note) {\n      signalRService.notifyTypingStarted(note.id);\n\n      // Clear existing timeout\n      if (typingTimeoutRef.current) {\n        clearTimeout(typingTimeoutRef.current);\n      }\n\n      // Set new timeout to notify typing stopped\n      typingTimeoutRef.current = setTimeout(() => {\n        if (note) {\n          signalRService.notifyTypingStopped(note.id);\n        }\n      }, 1000);\n\n      // Throttle content updates\n      const now = Date.now();\n      if (now - lastUpdateRef.current > 500) {\n        signalRService.updateNote(note.id, newContent);\n        lastUpdateRef.current = now;\n      } else {\n        if (updateTimeoutRef.current) {\n          clearTimeout(updateTimeoutRef.current);\n        }\n        updateTimeoutRef.current = setTimeout(() => {\n          signalRService.updateNote(note.id, newContent);\n          lastUpdateRef.current = Date.now();\n        }, 500);\n      }\n    }\n  };\n  const updateCursorPosition = () => {\n    if (!note || !contentRef.current) return;\n    const textarea = contentRef.current;\n    const cursorPosition = textarea.selectionStart;\n    signalRService.updateCursorPosition(note.id, cursorPosition);\n  };\n  const handleMouseMove = e => {\n    updateCursorPosition();\n  };\n  const handleKeyUp = e => {\n    updateCursorPosition();\n  };\n  const handleSave = async () => {\n    try {\n      setIsSaving(true);\n      await onSave({\n        ...(note || {}),\n        // Spread existing note if editing, empty object if creating\n        title,\n        content,\n        category\n      });\n      if (!note) {\n        // Clear form after creating new note\n        setTitle('');\n        setContent('');\n        setCategory('');\n      }\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  // Add selection tracking\n  const handleSelectionChange = () => {\n    if (!note || !contentRef.current) return;\n    const textarea = contentRef.current;\n    const selection = {\n      start: textarea.selectionStart,\n      end: textarea.selectionEnd\n    };\n    if (selection.start !== selection.end) {\n      signalRService.updateSelection(note.id, selection);\n    }\n  };\n\n  // Add undo/redo handling\n  const addToHistory = content => {\n    if (!contentRef.current) return;\n    setUndoStack(prev => [...prev, {\n      content,\n      cursorPosition: contentRef.current.selectionStart\n    }]);\n    setRedoStack([]);\n  };\n  const undo = () => {\n    var _contentRef$current$s, _contentRef$current;\n    if (undoStack.length === 0) return;\n    const current = {\n      content,\n      cursorPosition: (_contentRef$current$s = (_contentRef$current = contentRef.current) === null || _contentRef$current === void 0 ? void 0 : _contentRef$current.selectionStart) !== null && _contentRef$current$s !== void 0 ? _contentRef$current$s : 0\n    };\n    const previous = undoStack[undoStack.length - 1];\n    setRedoStack(prev => [...prev, current]);\n    setUndoStack(prev => prev.slice(0, -1));\n    setContent(previous.content);\n    if (contentRef.current) {\n      contentRef.current.selectionStart = previous.cursorPosition;\n      contentRef.current.selectionEnd = previous.cursorPosition;\n    }\n    if (note) {\n      signalRService.updateNote(note.id, previous.content);\n    }\n  };\n  const redo = () => {\n    var _contentRef$current$s2, _contentRef$current2;\n    if (redoStack.length === 0) return;\n    const current = {\n      content,\n      cursorPosition: (_contentRef$current$s2 = (_contentRef$current2 = contentRef.current) === null || _contentRef$current2 === void 0 ? void 0 : _contentRef$current2.selectionStart) !== null && _contentRef$current$s2 !== void 0 ? _contentRef$current$s2 : 0\n    };\n    const next = redoStack[redoStack.length - 1];\n    setUndoStack(prev => [...prev, current]);\n    setRedoStack(prev => prev.slice(0, -1));\n    setContent(next.content);\n    if (contentRef.current) {\n      contentRef.current.selectionStart = next.cursorPosition;\n      contentRef.current.selectionEnd = next.cursorPosition;\n    }\n    if (note) {\n      signalRService.updateNote(note.id, next.content);\n    }\n  };\n\n  // Add auto-save functionality\n  useEffect(() => {\n    if (note && content !== lastSavedRef.current) {\n      if (autoSaveTimeoutRef.current) {\n        clearTimeout(autoSaveTimeoutRef.current);\n      }\n      autoSaveTimeoutRef.current = setTimeout(() => {\n        handleSave();\n        lastSavedRef.current = content;\n      }, 3000); // Auto-save after 3 seconds of no changes\n    }\n    return () => {\n      if (autoSaveTimeoutRef.current) {\n        clearTimeout(autoSaveTimeoutRef.current);\n      }\n    };\n  }, [content, note]);\n\n  // Add keyboard shortcuts\n  useEffect(() => {\n    const handleKeyDown = e => {\n      if ((e.ctrlKey || e.metaKey) && e.key === 'z') {\n        e.preventDefault();\n        if (e.shiftKey) {\n          redo();\n        } else {\n          undo();\n        }\n      }\n    };\n    document.addEventListener('keydown', handleKeyDown);\n    return () => document.removeEventListener('keydown', handleKeyDown);\n  }, [undo, redo]);\n\n  // Add version saving functionality\n  const handleSaveVersion = async () => {\n    if (!note || !versionName.trim()) return;\n    try {\n      await signalRService.saveVersion(note.id, content, versionName);\n      setVersionName('');\n      // Version list will be updated via SignalR\n    } catch (err) {\n      console.error('Failed to save version:', err);\n    }\n  };\n\n  // Add version loading functionality\n  const loadVersion = version => {\n    setContent(version.content);\n    if (note) {\n      signalRService.updateNote(note.id, version.content);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"note-editor\",\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: note ? 'Edit Note' : 'Create Note'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 366,\n      columnNumber: 13\n    }, this), collaborators.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"collaborators\",\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        children: \"Currently editing: \"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 369,\n        columnNumber: 21\n      }, this), collaborators.map(collaborator => /*#__PURE__*/_jsxDEV(\"span\", {\n        className: `collaborator-badge ${collaborator.isTyping ? 'typing' : ''}`,\n        style: {\n          backgroundColor: getColorForUsername(collaborator.username)\n        },\n        children: [collaborator.username, collaborator.isTyping && /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"typing-indicator\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 377,\n          columnNumber: 55\n        }, this)]\n      }, collaborator.username, true, {\n        fileName: _jsxFileName,\n        lineNumber: 371,\n        columnNumber: 25\n      }, this))]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 368,\n      columnNumber: 17\n    }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n      type: \"text\",\n      placeholder: \"Title\",\n      value: title,\n      onChange: e => setTitle(e.target.value)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 382,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n      type: \"text\",\n      placeholder: \"Category\",\n      value: category,\n      onChange: e => setCategory(e.target.value)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 388,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"editor-toolbar\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: undo,\n        disabled: undoStack.length === 0,\n        children: \"Undo\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 395,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: redo,\n        disabled: redoStack.length === 0,\n        children: \"Redo\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 398,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => setShowVersions(!showVersions),\n        children: showVersions ? 'Hide Versions' : 'Show Versions'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 401,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 394,\n      columnNumber: 13\n    }, this), showVersions && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"version-panel\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"version-header\",\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          placeholder: \"Version name\",\n          value: versionName,\n          onChange: e => setVersionName(e.target.value)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 409,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleSaveVersion,\n          disabled: !versionName.trim(),\n          children: \"Save Version\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 415,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 408,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"version-list\",\n        children: versions.map(version => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"version-item\",\n          onClick: () => loadVersion(version),\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"version-name\",\n            children: version.name\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 429,\n            columnNumber: 33\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"version-date\",\n            children: new Date(version.createdAt).toLocaleString()\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 430,\n            columnNumber: 33\n          }, this)]\n        }, version.id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 424,\n          columnNumber: 29\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 422,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 407,\n      columnNumber: 17\n    }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n      ref: contentRef,\n      placeholder: \"Note content...\",\n      value: content,\n      onChange: handleContentChange,\n      onClick: handleMouseMove,\n      onKeyUp: handleKeyUp,\n      onSelect: handleSelectionChange\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 438,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"button-group\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleSave,\n        disabled: isSaving,\n        children: isSaving ? 'Saving...' : note ? 'Save' : 'Create'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 448,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: onCancel,\n        children: \"Cancel\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 454,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 447,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 365,\n    columnNumber: 9\n  }, this);\n};\n_s(NoteEditor, \"NKlbmwMPHNhU+30d8FahXafz+Qs=\");\n_c = NoteEditor;\nexport default NoteEditor;\nvar _c;\n$RefreshReg$(_c, \"NoteEditor\");","map":{"version":3,"names":["React","useEffect","useRef","useState","signalRService","jsxDEV","_jsxDEV","NoteEditor","note","onSave","onCancel","_s","title","setTitle","content","setContent","category","setCategory","isSaving","setIsSaving","collaborators","setCollaborators","contentRef","lastUpdateRef","updateTimeoutRef","typingTimeoutRef","undoStack","setUndoStack","redoStack","setRedoStack","lastSavedRef","autoSaveTimeoutRef","versions","setVersions","showVersions","setShowVersions","versionName","setVersionName","joinNote","id","onNoteUpdated","noteId","updatedContent","onCollaboratorJoined","username","prev","isTyping","onCollaboratorLeft","filter","c","onUserStartedTyping","map","onUserStoppedTyping","onCursorMoved","position","cursorPosition","showCollaboratorCursor","leaveNote","removeAllHandlers","current","clearTimeout","_contentRef$current$p","existingCursor","document","querySelector","remove","cursor","createElement","className","setAttribute","style","color","getColorForUsername","top","left","calculateCursorPosition","parentElement","appendChild","setTimeout","textArea","textBeforeCursor","substring","lines","split","lineHeight","charWidth","length","colors","hash","i","charCodeAt","Math","abs","handleContentChange","e","newContent","target","value","notifyTypingStarted","notifyTypingStopped","now","Date","updateNote","updateCursorPosition","textarea","selectionStart","handleMouseMove","handleKeyUp","handleSave","handleSelectionChange","selection","start","end","selectionEnd","updateSelection","addToHistory","undo","_contentRef$current$s","_contentRef$current","previous","slice","redo","_contentRef$current$s2","_contentRef$current2","next","handleKeyDown","ctrlKey","metaKey","key","preventDefault","shiftKey","addEventListener","removeEventListener","handleSaveVersion","trim","saveVersion","err","console","error","loadVersion","version","children","fileName","_jsxFileName","lineNumber","columnNumber","collaborator","backgroundColor","type","placeholder","onChange","onClick","disabled","name","createdAt","toLocaleString","ref","onKeyUp","onSelect","_c","$RefreshReg$"],"sources":["D:/_master/v5/notepad-plus/src/components/NoteEditor.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport { Note } from '../types/Note';\nimport { signalRService } from '../services/signalR';\nimport './NoteEditor.css';  // Make sure this is the exact path\n\ninterface NoteEditorProps {\n    note?: Note;\n    onSave: (note: Partial<Note>) => Promise<void>;\n    onCancel: () => void;\n}\n\ninterface Selection {\n    start: number;\n    end: number;\n}\n\ninterface CollaboratorState {\n    username: string;\n    isTyping: boolean;\n    cursorPosition?: number;\n    selection?: Selection;\n    color: string;\n}\n\ninterface HistoryEntry {\n    content: string;\n    cursorPosition: number;\n}\n\ninterface Version {\n    id: string;\n    content: string;\n    createdAt: Date;\n    name: string;\n}\n\nconst NoteEditor: React.FC<NoteEditorProps> = ({ note, onSave, onCancel }) => {\n    const [title, setTitle] = React.useState('');\n    const [content, setContent] = React.useState('');\n    const [category, setCategory] = React.useState('');\n    const [isSaving, setIsSaving] = React.useState(false);\n    const [collaborators, setCollaborators] = React.useState<CollaboratorState[]>([]);\n    const contentRef = useRef<HTMLTextAreaElement>(null);\n    const lastUpdateRef = useRef<number>(0);\n    const updateTimeoutRef = useRef<NodeJS.Timeout>();\n    const typingTimeoutRef = useRef<NodeJS.Timeout>();\n    const [undoStack, setUndoStack] = useState<HistoryEntry[]>([]);\n    const [redoStack, setRedoStack] = useState<HistoryEntry[]>([]);\n    const lastSavedRef = useRef<string>('');\n    const autoSaveTimeoutRef = useRef<NodeJS.Timeout>();\n    const [versions, setVersions] = useState<Version[]>([]);\n    const [showVersions, setShowVersions] = useState(false);\n    const [versionName, setVersionName] = useState('');\n\n    useEffect(() => {\n        if (note) {\n            // Editing existing note\n            setTitle(note.title);\n            setContent(note.content);\n            setCategory(note.category);\n            \n            // Join the note's SignalR group\n            signalRService.joinNote(note.id);\n\n            // Listen for updates from other users\n            signalRService.onNoteUpdated((noteId, updatedContent) => {\n                if (noteId === note.id) {\n                    setContent(updatedContent);\n                }\n            });\n\n            // Enhanced collaborator tracking\n            signalRService.onCollaboratorJoined((username) => {\n                setCollaborators(prev => [...prev, { username, isTyping: false }]);\n            });\n\n            signalRService.onCollaboratorLeft((username) => {\n                setCollaborators(prev => prev.filter(c => c.username !== username));\n            });\n\n            // Typing indicators\n            signalRService.onUserStartedTyping((username) => {\n                setCollaborators(prev => \n                    prev.map(c => c.username === username ? { ...c, isTyping: true } : c)\n                );\n            });\n\n            signalRService.onUserStoppedTyping((username) => {\n                setCollaborators(prev => \n                    prev.map(c => c.username === username ? { ...c, isTyping: false } : c)\n                );\n            });\n\n            // Cursor tracking\n            signalRService.onCursorMoved((username, position) => {\n                setCollaborators(prev => \n                    prev.map(c => c.username === username ? { ...c, cursorPosition: position } : c)\n                );\n                showCollaboratorCursor(username, position);\n            });\n        } else {\n            // Creating new note\n            setTitle('');\n            setContent('');\n            setCategory('');\n        }\n\n        return () => {\n            if (note) {\n                signalRService.leaveNote(note.id);\n                signalRService.removeAllHandlers(); // Clean up event handlers\n            }\n            if (typingTimeoutRef.current) {\n                clearTimeout(typingTimeoutRef.current);\n            }\n        };\n    }, [note?.id]);\n\n    const showCollaboratorCursor = (username: string, position: number) => {\n        if (!contentRef.current) return;\n\n        const existingCursor = document.querySelector(`.collaborator-cursor-${username}`);\n        existingCursor?.remove();\n\n        const cursor = document.createElement('div');\n        cursor.className = `collaborator-cursor collaborator-cursor-${username}`;\n        cursor.setAttribute('data-username', username);\n        cursor.style.color = getColorForUsername(username);\n\n        const { top, left } = calculateCursorPosition(position);\n        cursor.style.top = `${top}px`;\n        cursor.style.left = `${left}px`;\n\n        contentRef.current.parentElement?.appendChild(cursor);\n        setTimeout(() => cursor.remove(), 2000);\n    };\n\n    const calculateCursorPosition = (position: number) => {\n        if (!contentRef.current) return { top: 0, left: 0 };\n\n        const textArea = contentRef.current;\n        const textBeforeCursor = content.substring(0, position);\n        const lines = textBeforeCursor.split('\\n');\n        const lineHeight = 20; // Approximate line height\n        const charWidth = 8; // Approximate character width\n\n        return {\n            top: (lines.length - 1) * lineHeight,\n            left: lines[lines.length - 1].length * charWidth\n        };\n    };\n\n    const getColorForUsername = (username: string) => {\n        const colors = ['#2196f3', '#4caf50', '#f44336', '#ff9800', '#9c27b0'];\n        let hash = 0;\n        for (let i = 0; i < username.length; i++) {\n            hash = username.charCodeAt(i) + ((hash << 5) - hash);\n        }\n        return colors[Math.abs(hash) % colors.length];\n    };\n\n    const handleContentChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {\n        const newContent = e.target.value;\n        setContent(newContent);\n\n        // Notify typing started\n        if (note) {\n            signalRService.notifyTypingStarted(note.id);\n            \n            // Clear existing timeout\n            if (typingTimeoutRef.current) {\n                clearTimeout(typingTimeoutRef.current);\n            }\n\n            // Set new timeout to notify typing stopped\n            typingTimeoutRef.current = setTimeout(() => {\n                if (note) {\n                    signalRService.notifyTypingStopped(note.id);\n                }\n            }, 1000);\n\n            // Throttle content updates\n            const now = Date.now();\n            if (now - lastUpdateRef.current > 500) {\n                signalRService.updateNote(note.id, newContent);\n                lastUpdateRef.current = now;\n            } else {\n                if (updateTimeoutRef.current) {\n                    clearTimeout(updateTimeoutRef.current);\n                }\n                updateTimeoutRef.current = setTimeout(() => {\n                    signalRService.updateNote(note.id, newContent);\n                    lastUpdateRef.current = Date.now();\n                }, 500);\n            }\n        }\n    };\n\n    const updateCursorPosition = () => {\n        if (!note || !contentRef.current) return;\n        const textarea = contentRef.current;\n        const cursorPosition = textarea.selectionStart;\n        signalRService.updateCursorPosition(note.id, cursorPosition);\n    };\n\n    const handleMouseMove = (e: React.MouseEvent<HTMLTextAreaElement>) => {\n        updateCursorPosition();\n    };\n\n    const handleKeyUp = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {\n        updateCursorPosition();\n    };\n\n    const handleSave = async () => {\n        try {\n            setIsSaving(true);\n            await onSave({\n                ...(note || {}), // Spread existing note if editing, empty object if creating\n                title,\n                content,\n                category\n            });\n            if (!note) {\n                // Clear form after creating new note\n                setTitle('');\n                setContent('');\n                setCategory('');\n            }\n        } finally {\n            setIsSaving(false);\n        }\n    };\n\n    // Add selection tracking\n    const handleSelectionChange = () => {\n        if (!note || !contentRef.current) return;\n        \n        const textarea = contentRef.current;\n        const selection = {\n            start: textarea.selectionStart,\n            end: textarea.selectionEnd\n        };\n\n        if (selection.start !== selection.end) {\n            signalRService.updateSelection(note.id, selection);\n        }\n    };\n\n    // Add undo/redo handling\n    const addToHistory = (content: string) => {\n        if (!contentRef.current) return;\n\n        setUndoStack(prev => [...prev, {\n            content,\n            cursorPosition: contentRef.current.selectionStart\n        }]);\n        setRedoStack([]);\n    };\n\n    const undo = () => {\n        if (undoStack.length === 0) return;\n\n        const current = {\n            content,\n            cursorPosition: contentRef.current?.selectionStart ?? 0\n        };\n        const previous = undoStack[undoStack.length - 1];\n\n        setRedoStack(prev => [...prev, current]);\n        setUndoStack(prev => prev.slice(0, -1));\n        setContent(previous.content);\n\n        if (contentRef.current) {\n            contentRef.current.selectionStart = previous.cursorPosition;\n            contentRef.current.selectionEnd = previous.cursorPosition;\n        }\n\n        if (note) {\n            signalRService.updateNote(note.id, previous.content);\n        }\n    };\n\n    const redo = () => {\n        if (redoStack.length === 0) return;\n\n        const current = {\n            content,\n            cursorPosition: contentRef.current?.selectionStart ?? 0\n        };\n        const next = redoStack[redoStack.length - 1];\n\n        setUndoStack(prev => [...prev, current]);\n        setRedoStack(prev => prev.slice(0, -1));\n        setContent(next.content);\n\n        if (contentRef.current) {\n            contentRef.current.selectionStart = next.cursorPosition;\n            contentRef.current.selectionEnd = next.cursorPosition;\n        }\n\n        if (note) {\n            signalRService.updateNote(note.id, next.content);\n        }\n    };\n\n    // Add auto-save functionality\n    useEffect(() => {\n        if (note && content !== lastSavedRef.current) {\n            if (autoSaveTimeoutRef.current) {\n                clearTimeout(autoSaveTimeoutRef.current);\n            }\n\n            autoSaveTimeoutRef.current = setTimeout(() => {\n                handleSave();\n                lastSavedRef.current = content;\n            }, 3000); // Auto-save after 3 seconds of no changes\n        }\n\n        return () => {\n            if (autoSaveTimeoutRef.current) {\n                clearTimeout(autoSaveTimeoutRef.current);\n            }\n        };\n    }, [content, note]);\n\n    // Add keyboard shortcuts\n    useEffect(() => {\n        const handleKeyDown = (e: KeyboardEvent) => {\n            if ((e.ctrlKey || e.metaKey) && e.key === 'z') {\n                e.preventDefault();\n                if (e.shiftKey) {\n                    redo();\n                } else {\n                    undo();\n                }\n            }\n        };\n\n        document.addEventListener('keydown', handleKeyDown);\n        return () => document.removeEventListener('keydown', handleKeyDown);\n    }, [undo, redo]);\n\n    // Add version saving functionality\n    const handleSaveVersion = async () => {\n        if (!note || !versionName.trim()) return;\n        \n        try {\n            await signalRService.saveVersion(note.id, content, versionName);\n            setVersionName('');\n            // Version list will be updated via SignalR\n        } catch (err) {\n            console.error('Failed to save version:', err);\n        }\n    };\n\n    // Add version loading functionality\n    const loadVersion = (version: Version) => {\n        setContent(version.content);\n        if (note) {\n            signalRService.updateNote(note.id, version.content);\n        }\n    };\n\n    return (\n        <div className=\"note-editor\">\n            <h2>{note ? 'Edit Note' : 'Create Note'}</h2>\n            {collaborators.length > 0 && (\n                <div className=\"collaborators\">\n                    <span>Currently editing: </span>\n                    {collaborators.map(collaborator => (\n                        <span \n                            key={collaborator.username} \n                            className={`collaborator-badge ${collaborator.isTyping ? 'typing' : ''}`}\n                            style={{ backgroundColor: getColorForUsername(collaborator.username) }}\n                        >\n                            {collaborator.username}\n                            {collaborator.isTyping && <span className=\"typing-indicator\" />}\n                        </span>\n                    ))}\n                </div>\n            )}\n            <input\n                type=\"text\"\n                placeholder=\"Title\"\n                value={title}\n                onChange={(e) => setTitle(e.target.value)}\n            />\n            <input\n                type=\"text\"\n                placeholder=\"Category\"\n                value={category}\n                onChange={(e) => setCategory(e.target.value)}\n            />\n            <div className=\"editor-toolbar\">\n                <button onClick={undo} disabled={undoStack.length === 0}>\n                    Undo\n                </button>\n                <button onClick={redo} disabled={redoStack.length === 0}>\n                    Redo\n                </button>\n                <button onClick={() => setShowVersions(!showVersions)}>\n                    {showVersions ? 'Hide Versions' : 'Show Versions'}\n                </button>\n            </div>\n            \n            {showVersions && (\n                <div className=\"version-panel\">\n                    <div className=\"version-header\">\n                        <input\n                            type=\"text\"\n                            placeholder=\"Version name\"\n                            value={versionName}\n                            onChange={(e) => setVersionName(e.target.value)}\n                        />\n                        <button \n                            onClick={handleSaveVersion}\n                            disabled={!versionName.trim()}\n                        >\n                            Save Version\n                        </button>\n                    </div>\n                    <div className=\"version-list\">\n                        {versions.map(version => (\n                            <div \n                                key={version.id}\n                                className=\"version-item\"\n                                onClick={() => loadVersion(version)}\n                            >\n                                <span className=\"version-name\">{version.name}</span>\n                                <span className=\"version-date\">\n                                    {new Date(version.createdAt).toLocaleString()}\n                                </span>\n                            </div>\n                        ))}\n                    </div>\n                </div>\n            )}\n            <textarea\n                ref={contentRef}\n                placeholder=\"Note content...\"\n                value={content}\n                onChange={handleContentChange}\n                onClick={handleMouseMove}\n                onKeyUp={handleKeyUp}\n                onSelect={handleSelectionChange}\n            />\n            <div className=\"button-group\">\n                <button \n                    onClick={handleSave}\n                    disabled={isSaving}\n                >\n                    {isSaving ? 'Saving...' : (note ? 'Save' : 'Create')}\n                </button>\n                <button onClick={onCancel}>Cancel</button>\n            </div>\n        </div>\n    );\n};\n\nexport default NoteEditor;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}