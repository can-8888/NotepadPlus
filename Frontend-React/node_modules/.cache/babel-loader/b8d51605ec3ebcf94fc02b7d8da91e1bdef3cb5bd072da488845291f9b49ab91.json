{"ast":null,"code":"import { HubConnectionBuilder, HubConnectionState } from '@microsoft/signalr';\nimport { getCurrentUser } from './api';\nclass SignalRService {\n  constructor() {\n    this.hubConnection = null;\n    this.currentNoteId = null;\n    this.handlers = {};\n  }\n  async startConnection() {\n    try {\n      this.hubConnection = new HubConnectionBuilder().withUrl(`${process.env.REACT_APP_API_URL}/notehub`).withAutomaticReconnect().build();\n      await this.hubConnection.start();\n      console.log('SignalR Connected');\n    } catch (err) {\n      console.error('Error starting SignalR:', err);\n    }\n  }\n  async joinNote(noteId) {\n    var _this$hubConnection;\n    if (this.currentNoteId) {\n      await this.leaveNote(this.currentNoteId);\n    }\n    if (((_this$hubConnection = this.hubConnection) === null || _this$hubConnection === void 0 ? void 0 : _this$hubConnection.state) === HubConnectionState.Connected) {\n      await this.hubConnection.invoke('JoinNote', noteId);\n      this.currentNoteId = noteId;\n    }\n  }\n  async leaveNote(noteId) {\n    var _this$hubConnection2;\n    if (((_this$hubConnection2 = this.hubConnection) === null || _this$hubConnection2 === void 0 ? void 0 : _this$hubConnection2.state) === HubConnectionState.Connected) {\n      await this.hubConnection.invoke('LeaveNote', noteId);\n      this.currentNoteId = null;\n    }\n  }\n  onNoteUpdated(callback) {\n    var _this$hubConnection3;\n    this.handlers['NoteUpdated'] = callback;\n    (_this$hubConnection3 = this.hubConnection) === null || _this$hubConnection3 === void 0 ? void 0 : _this$hubConnection3.on('NoteUpdated', callback);\n  }\n  async updateNote(noteId, content) {\n    var _this$hubConnection4;\n    if (((_this$hubConnection4 = this.hubConnection) === null || _this$hubConnection4 === void 0 ? void 0 : _this$hubConnection4.state) === HubConnectionState.Connected) {\n      await this.hubConnection.invoke('UpdateNote', noteId, content);\n    }\n  }\n  onCursorMoved(callback) {\n    var _this$hubConnection5;\n    this.handlers['CursorMoved'] = callback;\n    (_this$hubConnection5 = this.hubConnection) === null || _this$hubConnection5 === void 0 ? void 0 : _this$hubConnection5.on('CursorMoved', callback);\n  }\n  async updateCursorPosition(noteId, position) {\n    var _this$hubConnection6;\n    const user = getCurrentUser();\n    if (user && ((_this$hubConnection6 = this.hubConnection) === null || _this$hubConnection6 === void 0 ? void 0 : _this$hubConnection6.state) === HubConnectionState.Connected) {\n      await this.hubConnection.invoke('CursorMoved', noteId, user.Username, position);\n    }\n  }\n\n  // Add new methods for collaborator presence\n  onCollaboratorJoined(callback) {\n    var _this$hubConnection7;\n    this.handlers['CollaboratorJoined'] = callback;\n    (_this$hubConnection7 = this.hubConnection) === null || _this$hubConnection7 === void 0 ? void 0 : _this$hubConnection7.on('CollaboratorJoined', callback);\n  }\n  onCollaboratorLeft(callback) {\n    var _this$hubConnection8;\n    this.handlers['CollaboratorLeft'] = callback;\n    (_this$hubConnection8 = this.hubConnection) === null || _this$hubConnection8 === void 0 ? void 0 : _this$hubConnection8.on('CollaboratorLeft', callback);\n  }\n\n  // Helper method to remove event handlers when needed\n  removeAllHandlers() {\n    if (this.hubConnection) {\n      Object.entries(this.handlers).forEach(([event, handler]) => {\n        var _this$hubConnection9;\n        (_this$hubConnection9 = this.hubConnection) === null || _this$hubConnection9 === void 0 ? void 0 : _this$hubConnection9.on(event, handler); // Re-register with empty handler\n      });\n      this.handlers = {};\n    }\n  }\n  onUserStartedTyping(callback) {\n    var _this$hubConnection10;\n    this.handlers['UserStartedTyping'] = callback;\n    (_this$hubConnection10 = this.hubConnection) === null || _this$hubConnection10 === void 0 ? void 0 : _this$hubConnection10.on('UserStartedTyping', callback);\n  }\n  onUserStoppedTyping(callback) {\n    var _this$hubConnection11;\n    this.handlers['UserStoppedTyping'] = callback;\n    (_this$hubConnection11 = this.hubConnection) === null || _this$hubConnection11 === void 0 ? void 0 : _this$hubConnection11.on('UserStoppedTyping', callback);\n  }\n  async notifyTypingStarted(noteId) {\n    var _this$hubConnection12;\n    if (((_this$hubConnection12 = this.hubConnection) === null || _this$hubConnection12 === void 0 ? void 0 : _this$hubConnection12.state) === HubConnectionState.Connected) {\n      await this.hubConnection.invoke('StartTyping', noteId);\n    }\n  }\n  async notifyTypingStopped(noteId) {\n    var _this$hubConnection13;\n    if (((_this$hubConnection13 = this.hubConnection) === null || _this$hubConnection13 === void 0 ? void 0 : _this$hubConnection13.state) === HubConnectionState.Connected) {\n      await this.hubConnection.invoke('StopTyping', noteId);\n    }\n  }\n}\nexport const signalRService = new SignalRService();","map":{"version":3,"names":["HubConnectionBuilder","HubConnectionState","getCurrentUser","SignalRService","constructor","hubConnection","currentNoteId","handlers","startConnection","withUrl","process","env","REACT_APP_API_URL","withAutomaticReconnect","build","start","console","log","err","error","joinNote","noteId","_this$hubConnection","leaveNote","state","Connected","invoke","_this$hubConnection2","onNoteUpdated","callback","_this$hubConnection3","on","updateNote","content","_this$hubConnection4","onCursorMoved","_this$hubConnection5","updateCursorPosition","position","_this$hubConnection6","user","Username","onCollaboratorJoined","_this$hubConnection7","onCollaboratorLeft","_this$hubConnection8","removeAllHandlers","Object","entries","forEach","event","handler","_this$hubConnection9","onUserStartedTyping","_this$hubConnection10","onUserStoppedTyping","_this$hubConnection11","notifyTypingStarted","_this$hubConnection12","notifyTypingStopped","_this$hubConnection13","signalRService"],"sources":["D:/_master/v5/notepad-plus/src/services/signalR.ts"],"sourcesContent":["import { HubConnection, HubConnectionBuilder, HubConnectionState } from '@microsoft/signalr';\r\nimport { getCurrentUser } from './api';\r\n\r\nclass SignalRService {\r\n    private hubConnection: HubConnection | null = null;\r\n    private currentNoteId: number | null = null;\r\n    private handlers: { [key: string]: (...args: any[]) => void } = {};\r\n\r\n    public async startConnection(): Promise<void> {\r\n        try {\r\n            this.hubConnection = new HubConnectionBuilder()\r\n                .withUrl(`${process.env.REACT_APP_API_URL}/notehub`)\r\n                .withAutomaticReconnect()\r\n                .build();\r\n\r\n            await this.hubConnection.start();\r\n            console.log('SignalR Connected');\r\n        } catch (err) {\r\n            console.error('Error starting SignalR:', err);\r\n        }\r\n    }\r\n\r\n    public async joinNote(noteId: number): Promise<void> {\r\n        if (this.currentNoteId) {\r\n            await this.leaveNote(this.currentNoteId);\r\n        }\r\n        \r\n        if (this.hubConnection?.state === HubConnectionState.Connected) {\r\n            await this.hubConnection.invoke('JoinNote', noteId);\r\n            this.currentNoteId = noteId;\r\n        }\r\n    }\r\n\r\n    public async leaveNote(noteId: number): Promise<void> {\r\n        if (this.hubConnection?.state === HubConnectionState.Connected) {\r\n            await this.hubConnection.invoke('LeaveNote', noteId);\r\n            this.currentNoteId = null;\r\n        }\r\n    }\r\n\r\n    public onNoteUpdated(callback: (noteId: number, content: string) => void): void {\r\n        this.handlers['NoteUpdated'] = callback;\r\n        this.hubConnection?.on('NoteUpdated', callback);\r\n    }\r\n\r\n    public async updateNote(noteId: number, content: string): Promise<void> {\r\n        if (this.hubConnection?.state === HubConnectionState.Connected) {\r\n            await this.hubConnection.invoke('UpdateNote', noteId, content);\r\n        }\r\n    }\r\n\r\n    public onCursorMoved(callback: (username: string, position: number) => void): void {\r\n        this.handlers['CursorMoved'] = callback;\r\n        this.hubConnection?.on('CursorMoved', callback);\r\n    }\r\n\r\n    public async updateCursorPosition(noteId: number, position: number): Promise<void> {\r\n        const user = getCurrentUser();\r\n        if (user && this.hubConnection?.state === HubConnectionState.Connected) {\r\n            await this.hubConnection.invoke('CursorMoved', noteId, user.Username, position);\r\n        }\r\n    }\r\n\r\n    // Add new methods for collaborator presence\r\n    public onCollaboratorJoined(callback: (username: string) => void): void {\r\n        this.handlers['CollaboratorJoined'] = callback;\r\n        this.hubConnection?.on('CollaboratorJoined', callback);\r\n    }\r\n\r\n    public onCollaboratorLeft(callback: (username: string) => void): void {\r\n        this.handlers['CollaboratorLeft'] = callback;\r\n        this.hubConnection?.on('CollaboratorLeft', callback);\r\n    }\r\n\r\n    // Helper method to remove event handlers when needed\r\n    public removeAllHandlers(): void {\r\n        if (this.hubConnection) {\r\n            Object.entries(this.handlers).forEach(([event, handler]) => {\r\n                this.hubConnection?.on(event, handler);  // Re-register with empty handler\r\n            });\r\n            this.handlers = {};\r\n        }\r\n    }\r\n\r\n    public onUserStartedTyping(callback: (username: string) => void): void {\r\n        this.handlers['UserStartedTyping'] = callback;\r\n        this.hubConnection?.on('UserStartedTyping', callback);\r\n    }\r\n\r\n    public onUserStoppedTyping(callback: (username: string) => void): void {\r\n        this.handlers['UserStoppedTyping'] = callback;\r\n        this.hubConnection?.on('UserStoppedTyping', callback);\r\n    }\r\n\r\n    public async notifyTypingStarted(noteId: number): Promise<void> {\r\n        if (this.hubConnection?.state === HubConnectionState.Connected) {\r\n            await this.hubConnection.invoke('StartTyping', noteId);\r\n        }\r\n    }\r\n\r\n    public async notifyTypingStopped(noteId: number): Promise<void> {\r\n        if (this.hubConnection?.state === HubConnectionState.Connected) {\r\n            await this.hubConnection.invoke('StopTyping', noteId);\r\n        }\r\n    }\r\n}\r\n\r\nexport const signalRService = new SignalRService(); "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}